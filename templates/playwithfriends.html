{% extends "base.html" %}

{% block title %}Play With Friends{% endblock %}

{% block content %}
  {% if not user_name %}
    <h2>Enter your name to join:</h2>
    <form method="post" action="/enter_play">
      <input type="text" name="user_name" placeholder="Your name" required>
      <button type="submit">Join</button>
    </form>
  {% else %}
    <h2>Welcome {{user_name}}</h2>
    <section class="chat">
      <ul id="messages"></ul>
      <input id="messageText" type="text" placeholder="Type a message..." />
      <button onclick="sendMessage()">Send</button>
    </section>
  {% endif %}
{% endblock %}

{% block scripts %}
<script>
  // Helper to read cookies
  function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
  }

  // Identify the user
  var client_id = getCookie('user_name');

  // Connect to WebSocket backend
  var ws = new WebSocket("ws://127.0.0.1:8000/ws");

  // Handle incoming messages
  ws.onmessage = function(event) {
    var messages = document.getElementById('messages');
    var message = document.createElement('li');
    message.textContent = event.data;
    messages.appendChild(message);
  };

  // Send a message
  function sendMessage() {
    var input = document.getElementById("messageText");
    if (input.value.trim() !== "") {
      ws.send(client_id + ": " + input.value);
      input.value = "";
    }
  }
</script>
{% endblock %}
